<!DOCTYPE html>
<html lang="no">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Produktdetaljer | BrandRadar</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
<header class="main-header">
  <a class="logo" href="index.html">BrandRadar</a>
  <nav class="top-nav">
    <a href="index.html">Home</a>
    <a href="news.html">News</a>
    <a href="brands.html">Brands</a>
    <a href="favoritter.html">Favoritter (<span data-fav-count>0</span>)</a>
  </nav>
</header>

<main class="product-main">
  <div class="product-gallery">
    <span id="product-badge" class="badge"></span>
    <button id="favorite-btn" class="favorite-btn">
      <svg viewBox="0 0 24 24"><path d="M12 21s-7-4.35-10-8.87C-1.33 8.24 1.42 3 6.6 3 9.07 3 12 5.09 12 5.09S14.93 3 17.4 3c5.18 0 7.93 5.24 4.6 9.13C19 16.65 12 21 12 21z"/></svg>
    </button>
    <img id="product-image" src="" alt="Produktbilde">
    <div id="thumbnail-container" class="thumbnail-container"></div>
  </div>

  <div class="product-details">
    <h1 id="product-title"></h1>
    <div id="product-brand" class="product-meta"></div>
    <div id="product-category" class="product-meta"></div>
    <div id="product-price" class="product-price"></div>
    <div id="product-rating" class="rating"></div>
    <a id="buy-button" class="buy-button" href="#" target="_blank">Kjøp nå</a>
    <div id="product-description" class="product-description"></div>
    <a href="index.html" class="back-link">← Tilbake</a>
  </div>
</main>

<div id="fav-popup" class="fav-popup"></div>

<script>
const key = "favorites";
function showPopup(msg){const p=document.getElementById("fav-popup");p.textContent=msg;p.classList.add("show");setTimeout(()=>p.classList.remove("show"),1500);}
function updateFavCount(){const c=JSON.parse(localStorage.getItem(key)||"[]").length;document.querySelectorAll("[data-fav-count]").forEach(el=>el.textContent=c);}
const d=localStorage.getItem("selectedProduct");
if(d){
  const p=JSON.parse(d);
  const mainImg=document.getElementById("product-image");
  mainImg.src=p.image;
  document.getElementById("product-title").textContent=p.title;
  document.getElementById("product-brand").textContent="Brand: "+(p.brand||"");
  document.getElementById("product-category").textContent=`${p.gender||""} • ${p.subcategory||""}`;
  document.getElementById("product-price").textContent="Pris: "+(p.price||"");
  document.getElementById("buy-button").href=p.link||"#";
  if(p.description)document.getElementById("product-description").textContent=p.description;
  if(p.rating)document.getElementById("product-rating").textContent="⭐ "+p.rating;

  const b=document.getElementById("product-badge");
  let disc=p.discount||"";
  if(!isNaN(disc)&&disc!==""){const n=parseFloat(disc);if(n>0&&n<1)disc=Math.round(n*100)+"%";}
  if(disc){const t=String(disc).replace(/["%]/g,"").trim();const n=/nyhet|new/i.test(t);b.textContent=n?"Nyhet!":"Discount: "+t+"%";if(n)b.classList.add("new");}else b.style.display="none";

  const fav=document.getElementById("favorite-btn");
  let favs=JSON.parse(localStorage.getItem(key)||"[]");
  if(favs.some(x=>x.title===p.title))fav.classList.add("active");

  fav.addEventListener("click",()=>{
    let list=JSON.parse(localStorage.getItem(key)||"[]");
    const ex=list.some(x=>x.title===p.title);
    if(ex){list=list.filter(x=>x.title!==p.title);fav.classList.remove("active");showPopup("Fjernet fra favoritter ❌");}
    else{list.push(p);fav.classList.add("active");showPopup("Lagt til i favoritter ❤️");}
    localStorage.setItem(key,JSON.stringify(list));updateFavCount();
  });

  const thumbs=document.getElementById("thumbnail-container");
  [p.image,p.image2,p.image3,p.image4].filter(Boolean).forEach((img,i)=>{
    const t=document.createElement("img");
    t.src=img;if(i===0)t.style.borderColor="#000";
    t.addEventListener("click",()=>{mainImg.src=img;document.querySelectorAll(".thumbnail-container img").forEach(x=>x.style.borderColor="transparent");t.style.borderColor="#000";});
    thumbs.appendChild(t);
  });
}
updateFavCount();
</script>
</body>
</html>

